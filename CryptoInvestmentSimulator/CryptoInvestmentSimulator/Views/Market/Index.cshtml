@using CryptoInvestmentSimulator.Models.ViewModels
@model List<MarketDataModel>;
@{
	ViewData["Title"] = "Market Page";
}

<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
<script>
	window.onload = function () 
	{
		// Gets pre generated mock chart points
		var chartPoints = @Html.Raw(ViewBag.ChartPoints);
 
		// Creates and configures renderable chart
		var chart = new CanvasJS.Chart("chartContainer", 
		{
			zoomEnabled: false,
			axisX: 
			{
				title: "",
				crosshair: 
				{
					enabled: true,
					snapToDataPoint: true
				}
			},
			axisY: 
			{
				crosshair: 
				{
					enabled: true,
					snapToDataPoint: true,
					valueFormatString: "#,##0"
				}
			},
			toolTip: 
			{
				shared: true
			},
			legend: 
			{
				dockInsidePlotArea: true,
				verticalAlign: "top",
				horizontalAlign: "right"
			},
			data: 
			[{
				type: "line",
				markerType: "none",
				xValueType: "dateTime",
				xValueFormatString: "hh:mm:ss",
				name: "Bitcoin",
				showInLegend: true,
				dataPoints: chartPoints
			}]
		});
 
		chart.render();
 
		var updateInterval = @Html.Raw(ViewBag.UpdateInterval);
		var pricePoint = @Html.Raw(ViewBag.PricePoint);
		var timePoint = new Date(@Html.Raw(ViewBag.TimePoint));
 
		function updateChart(count) 
		{
			count = count || 1;

			for (var i = 0; i < count; i++) 
			{
				timePoint.setTime(timePoint.getTime() + updateInterval);
				var randomChange = .5 + Math.random() * (-.5 - .5);
 
				pricePoint = Math.round((pricePoint + randomChange) * 100) / 100;

				chartPoints.push({ x: timePoint.getTime(), y: pricePoint });
			}
 
			chart.render();
		}
 
		setInterval(function () { updateChart() }, updateInterval);
	}
</script>

<div class="text-center">

	<h1 class="display-4">Try to request a response!</h1>

	<table class="table table-hover table-dark border-warning">
		<thead>
			<tr>
				<th scope="col">#</th>
				<th scope="col">Cryptocurrency</th>
				<th scope="col">Converted to</th>
				<th scope="col">Collection time</th>
				<th scope="col">Price per unit</th>
				<th scope="col">Daily change</th>
				<th scope="col">Weekly change</th>
				<th scope="col">Chart</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<th scope="row">1</th>
				<td>@Model[0].CryptoSymbol</td>
				<td>@Model[0].FiatSymbol</td>
				<td>@Model[0].CollectionDateTime</td>
				<td>@Model[0].FiatPricePerUnit</td>
				<td>@Model[0].PercentChange24h%</td>
				<td>@Model[0].PercentChange7d%</td>
				<td><a class="text-danger" asp-controller="Market" asp-action="Bitcoin">BTC/EUR</a></td>
			</tr>
			<tr>
				<th scope="row">2</th>
				<td>@Model[1].CryptoSymbol</td>
				<td>@Model[1].FiatSymbol</td>
				<td>@Model[1].CollectionDateTime</td>
				<td>@Model[1].FiatPricePerUnit</td>
				<td>@Model[1].PercentChange24h%</td>
				<td>@Model[1].PercentChange7d%</td>
				<td><a class="text-danger" asp-controller="Market" asp-action="Etherium">ETH/EUR</a></td>
			</tr>
			<tr>
				<th scope="row">3</th>
				<td>@Model[2].CryptoSymbol</td>
				<td>@Model[2].FiatSymbol</td>
				<td>@Model[2].CollectionDateTime</td>
				<td>@Model[2].FiatPricePerUnit</td>
				<td>@Model[2].PercentChange24h%</td>
				<td>@Model[2].PercentChange7d%</td>
				<td><a class="text-danger" asp-controller="Market" asp-action="Cardano">ADA/EUR</a></td>
			</tr>
			<tr>
				<th scope="row">4</th>
				<td>@Model[3].CryptoSymbol</td>
				<td>@Model[3].FiatSymbol</td>
				<td>@Model[3].CollectionDateTime</td>
				<td>@Model[3].FiatPricePerUnit</td>
				<td>@Model[3].PercentChange24h%</td>
				<td>@Model[3].PercentChange7d%</td>
				<td><a class="text-danger" asp-controller="Market" asp-action="Cosmos">ATOM/EUR</a></td>
			</tr>
			<tr>
				<th scope="row">5</th>
				<td>@Model[4].CryptoSymbol</td>
				<td>@Model[4].FiatSymbol</td>
				<td>@Model[4].CollectionDateTime</td>
				<td>@Model[4].FiatPricePerUnit</td>
				<td>@Model[4].PercentChange24h%</td>
				<td>@Model[4].PercentChange7d%</td>
				<td><a class="text-danger" asp-controller="Market" asp-action="Dogecoin">DOGE/EUR</a></td>
			</tr>
		</tbody>

	</table>

	<a class="text-danger" asp-controller="Market" asp-action="Index">Refresh</a>

	<div id="chartContainer" style="height: 400px; width: 100%;"></div>

</div>
